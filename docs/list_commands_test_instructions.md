# /listå‘½ä»¤ä¿®å¤éªŒè¯æŒ‡å—

## å¿«é€ŸéªŒè¯

### 1. è¿è¡Œè‡ªåŠ¨åŒ–æµ‹è¯•

```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd /home/ogas/Code/CN/Chat-Room

# è¿è¡Œæ ¸å¿ƒä¿®å¤éªŒè¯
python test/test_core_message_fix.py
```

**æœŸæœ›è¾“å‡ºï¼š**
```
ğŸš€ å¼€å§‹éªŒè¯æ ¸å¿ƒæ¶ˆæ¯ä¿®å¤æ•ˆæœ...
==================================================

ğŸ“‹ BaseMessageä¿®å¤:
âœ… BaseMessageä¿®å¤ é€šè¿‡

ğŸ“‹ ä¸“ç”¨æ¶ˆæ¯ç±»:
âœ… ä¸“ç”¨æ¶ˆæ¯ç±» é€šè¿‡

ğŸ“‹ æ¶ˆæ¯ç±»å‹æ˜ å°„:
âœ… æ¶ˆæ¯ç±»å‹æ˜ å°„ é€šè¿‡

ğŸ“‹ å®¢æˆ·ç«¯ä»£ç åˆ†æ:
âœ… å®¢æˆ·ç«¯ä»£ç åˆ†æ é€šè¿‡

ğŸ“‹ å¯¼å…¥è¯­å¥:
âœ… å¯¼å…¥è¯­å¥ é€šè¿‡

==================================================
æµ‹è¯•ç»“æœ: 5/5 é€šè¿‡
ğŸ‰ æ‰€æœ‰æ ¸å¿ƒä¿®å¤éªŒè¯é€šè¿‡ï¼
```

### 2. æ‰‹åŠ¨åŠŸèƒ½æµ‹è¯•

#### å¯åŠ¨æœåŠ¡å™¨
```bash
# ç»ˆç«¯1ï¼šå¯åŠ¨æœåŠ¡å™¨
cd /home/ogas/Code/CN/Chat-Room
python server/main.py
```

#### å¯åŠ¨å®¢æˆ·ç«¯ï¼ˆTUIæ¨¡å¼ï¼‰
```bash
# ç»ˆç«¯2ï¼šå¯åŠ¨å®¢æˆ·ç«¯
cd /home/ogas/Code/CN/Chat-Room
python client/main.py
```

#### å¯åŠ¨å®¢æˆ·ç«¯ï¼ˆè°ƒè¯•æ¨¡å¼ï¼‰
```bash
# ç»ˆç«¯2ï¼šå¯åŠ¨å®¢æˆ·ç«¯ï¼ˆè°ƒè¯•æ¨¡å¼ï¼Œå¯ä»¥çœ‹åˆ°æ›´å¤šæ—¥å¿—ï¼‰
cd /home/ogas/Code/CN/Chat-Room
python client/main.py --debug
```

### 3. æµ‹è¯•æ‰€æœ‰/listå‘½ä»¤

ç™»å½•åä¾æ¬¡æµ‹è¯•ä»¥ä¸‹å‘½ä»¤ï¼š

```
# 1. æ˜¾ç¤ºæ‰€æœ‰ç”¨æˆ·
/list -u

# 2. æ˜¾ç¤ºå½“å‰èŠå¤©ç»„ç”¨æˆ·ï¼ˆéœ€è¦å…ˆè¿›å…¥èŠå¤©ç»„ï¼‰
/enter public
/list -s

# 3. æ˜¾ç¤ºå·²åŠ å…¥çš„èŠå¤©ç»„
/list -c

# 4. æ˜¾ç¤ºæ‰€æœ‰ç¾¤èŠ
/list -g

# 5. æ˜¾ç¤ºå½“å‰èŠå¤©ç»„æ–‡ä»¶ï¼ˆéœ€è¦åœ¨èŠå¤©ç»„ä¸­ï¼‰
/list -f
```

### 4. éªŒè¯æ—¥å¿—è®°å½•

#### æŸ¥çœ‹å®¢æˆ·ç«¯æ—¥å¿—
```bash
# å®æ—¶æŸ¥çœ‹å®¢æˆ·ç«¯æ—¥å¿—
tail -f logs/client.log

# æŸ¥çœ‹æœ€è¿‘çš„æ—¥å¿—
tail -20 logs/client.log
```

#### æŸ¥çœ‹æœåŠ¡å™¨æ—¥å¿—
```bash
# å®æ—¶æŸ¥çœ‹æœåŠ¡å™¨æ—¥å¿—
tail -f logs/server/server.log

# æŸ¥çœ‹æœ€è¿‘çš„æ—¥å¿—
tail -20 logs/server/server.log
```

## ä¿®å¤å‰åå¯¹æ¯”

### ä¿®å¤å‰çš„é”™è¯¯ï¼ˆå·²è§£å†³ï¼‰

```
[14:06:24] é”™è¯¯ï¼šÃ— æ¶ˆæ¯æ ¼å¼é”™è¯¯
[14:06:38] é”™è¯¯ï¼šÃ— æ¶ˆæ¯æ ¼å¼é”™è¯¯
[14:06:44] é”™è¯¯ï¼šÃ— æ¶ˆæ¯æ ¼å¼é”™è¯¯
[14:06:47] é”™è¯¯ï¼šÃ— æ¶ˆæ¯æ ¼å¼é”™è¯¯
[14:06:52] é”™è¯¯ï¼šÃ— å‘½ä»¤æ‰§è¡Œé”™è¯¯ï¼šBaseMessage.__init__() got an unexpected keyword argument 'chat_group_id'
```

### ä¿®å¤åçš„æ­£å¸¸è¾“å‡º

```
[15:30:15] ç³»ç»Ÿ: âœ… æ‰€æœ‰ç”¨æˆ·åˆ—è¡¨:
  test_user (ID: 1) - åœ¨çº¿
  alice (ID: 2) - ç¦»çº¿
  bob (ID: 3) - åœ¨çº¿

[15:30:20] ç³»ç»Ÿ: âœ… å½“å‰èŠå¤©ç»„ç”¨æˆ·:
  test_user (ID: 1) - åœ¨çº¿
  alice (ID: 2) - åœ¨çº¿

[15:30:25] ç³»ç»Ÿ: âœ… å·²åŠ å…¥çš„èŠå¤©ç»„:
  public (ID: 1) - ç¾¤èŠ - 3äºº
  test_group (ID: 2) - ç¾¤èŠ - 2äºº

[15:30:30] ç³»ç»Ÿ: âœ… æ‰€æœ‰ç¾¤èŠ:
  public (ID: 1) - ç¾¤èŠ - 3äºº
  test_group (ID: 2) - ç¾¤èŠ - 2äºº
  private_room (ID: 3) - ç¾¤èŠ - 5äºº

[15:30:35] ç³»ç»Ÿ: âœ… å½“å‰èŠå¤©ç»„æ–‡ä»¶:
  document.pdf (1.2MB) - ä¸Šä¼ è€…: alice - 2024-01-15
  image.jpg (256KB) - ä¸Šä¼ è€…: bob - 2024-01-16
```

## æ—¥å¿—è®°å½•éªŒè¯

### æœŸæœ›çš„æ—¥å¿—å†…å®¹

**å‘½ä»¤æ‰§è¡Œå¼€å§‹ï¼š**
```json
{
  "timestamp": "2025-06-11T15:30:15.123456+08:00",
  "level": "INFO",
  "message": "æ‰§è¡Œå‘½ä»¤",
  "command": "list",
  "args": [],
  "options": {"-u": true}
}
```

**ç”¨æˆ·æ“ä½œè®°å½•ï¼š**
```json
{
  "timestamp": "2025-06-11T15:30:15.124567+08:00",
  "level": "INFO", 
  "message": "ç”¨æˆ·æ“ä½œ: test_user(1) - command_list",
  "user_id": 1,
  "username": "test_user",
  "action": "command_list"
}
```

**å‘½ä»¤æ‰§è¡ŒæˆåŠŸï¼š**
```json
{
  "timestamp": "2025-06-11T15:30:15.234567+08:00",
  "level": "INFO",
  "message": "å‘½ä»¤æ‰§è¡ŒæˆåŠŸ",
  "command": "list",
  "duration": 0.11,
  "result_length": 156
}
```

**ç½‘ç»œé€šä¿¡æ—¥å¿—ï¼š**
```json
{
  "timestamp": "2025-06-11T15:30:15.125678+08:00",
  "level": "DEBUG",
  "message": "å‘é€æ¶ˆæ¯",
  "message_type": "LIST_USERS_REQUEST",
  "size": 89
}
```

## æ•…éšœæ’é™¤

### å¦‚æœæµ‹è¯•å¤±è´¥

1. **æ£€æŸ¥Pythonç¯å¢ƒ**
   ```bash
   python --version  # åº”è¯¥æ˜¯ 3.8+
   pip list | grep textual  # æ£€æŸ¥TUIä¾èµ–
   ```

2. **æ£€æŸ¥é¡¹ç›®ç»“æ„**
   ```bash
   ls -la shared/messages.py
   ls -la client/core/client.py
   ls -la logs/  # æ£€æŸ¥æ—¥å¿—ç›®å½•
   ```

3. **é‡æ–°å®‰è£…ä¾èµ–**
   ```bash
   pip install -r requirements.txt
   ```

4. **æ¸…ç†å¹¶é‡å¯**
   ```bash
   # æ¸…ç†æ—¥å¿—æ–‡ä»¶
   rm -rf logs/*
   
   # é‡æ–°å¯åŠ¨æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯
   ```

### å¸¸è§é—®é¢˜

**Q: å‘½ä»¤ä»ç„¶æŠ¥"æ¶ˆæ¯æ ¼å¼é”™è¯¯"**
A: ç¡®ä¿æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯éƒ½ä½¿ç”¨äº†æœ€æ–°çš„ä»£ç ï¼Œé‡å¯ä¸¤ç«¯ç¨‹åºã€‚

**Q: æ—¥å¿—æ–‡ä»¶æ²¡æœ‰ç”Ÿæˆ**
A: æ£€æŸ¥ `logs/` ç›®å½•æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨è¯·åˆ›å»ºï¼š`mkdir -p logs`

**Q: TUIç•Œé¢æ˜¾ç¤ºå¼‚å¸¸**
A: å°è¯•ä½¿ç”¨è°ƒè¯•æ¨¡å¼å¯åŠ¨ï¼š`python client/main.py --debug`

**Q: æœåŠ¡å™¨è¿æ¥å¤±è´¥**
A: ç¡®ä¿æœåŠ¡å™¨å·²å¯åŠ¨ï¼Œç«¯å£8888æœªè¢«å ç”¨ã€‚

## æ€§èƒ½éªŒè¯

### å“åº”æ—¶é—´æµ‹è¯•

æ­£å¸¸æƒ…å†µä¸‹ï¼Œ`/list` å‘½ä»¤åº”è¯¥åœ¨200mså†…è¿”å›ç»“æœï¼š

```bash
# ä½¿ç”¨timeå‘½ä»¤æµ‹è¯•
time python test/test_core_message_fix.py
```

### å†…å­˜ä½¿ç”¨æµ‹è¯•

```bash
# ç›‘æ§å†…å­˜ä½¿ç”¨
python -c "
import sys, tracemalloc
sys.path.insert(0, '.')
tracemalloc.start()
from test.test_core_message_fix import main
main()
current, peak = tracemalloc.get_traced_memory()
print(f'å½“å‰å†…å­˜: {current / 1024 / 1024:.1f} MB')
print(f'å³°å€¼å†…å­˜: {peak / 1024 / 1024:.1f} MB')
"
```

## æ€»ç»“

é€šè¿‡ä»¥ä¸Šæµ‹è¯•ï¼Œæ‚¨å¯ä»¥éªŒè¯ï¼š

1. âœ… æ‰€æœ‰ `/list` å‘½ä»¤ä¸å†æŠ¥é”™
2. âœ… æ¶ˆæ¯æ ¼å¼é”™è¯¯å·²è§£å†³
3. âœ… BaseMessageå‚æ•°é”™è¯¯å·²è§£å†³
4. âœ… å®¢æˆ·ç«¯æ—¥å¿—æ­£ç¡®æŒä¹…åŒ–åˆ°æ–‡ä»¶
5. âœ… TUIç•Œé¢ä¸å†è¢«æ—¥å¿—å¹²æ‰°
6. âœ… æ‰€æœ‰å‘½ä»¤æ‰§è¡Œéƒ½æœ‰å®Œæ•´çš„æ—¥å¿—è®°å½•
7. âœ… æ¶ˆæ¯åºåˆ—åŒ–å’Œååºåˆ—åŒ–æ­£å¸¸
8. âœ… å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨é€šä¿¡æ­£å¸¸

å¦‚æœæ‰€æœ‰æµ‹è¯•éƒ½é€šè¿‡ï¼Œè¯´æ˜ä¿®å¤å®Œå…¨æˆåŠŸï¼ğŸ‰

## ä¸‹ä¸€æ­¥

ä¿®å¤å®Œæˆåï¼Œå»ºè®®ï¼š

1. **å®šæœŸæ£€æŸ¥æ—¥å¿—** - ç›‘æ§ `logs/client.log` å’Œ `logs/server/server.log`
2. **æ€§èƒ½ç›‘æ§** - è§‚å¯Ÿå‘½ä»¤å“åº”æ—¶é—´å’Œå†…å­˜ä½¿ç”¨
3. **ç”¨æˆ·åé¦ˆ** - æ”¶é›†ç”¨æˆ·ä½¿ç”¨ä½“éªŒï¼ŒæŒç»­æ”¹è¿›
4. **åŠŸèƒ½æ‰©å±•** - åŸºäºç¨³å®šçš„åŸºç¡€æ¶æ„æ·»åŠ æ–°åŠŸèƒ½

# /list命令测试指南

## 概述

本文档提供了测试Chat-Room项目中`/list`系列命令的完整指南，确保所有修复都能正常工作。

## 测试环境准备

### 1. 启动服务器

```bash
cd /home/ogas/Code/CN/Chat-Room
python server/main.py
```

### 2. 启动客户端

```bash
cd /home/ogas/Code/CN/Chat-Room
python client/main.py
```

### 3. 登录用户

在客户端界面中：
1. 选择登录或注册
2. 输入用户名和密码
3. 确保成功登录

## 测试用例

### 1. 测试 `/list -u` (列出所有用户)

**预期行为：**
- 显示系统中所有用户的列表
- 包含用户ID、用户名和在线状态

**测试步骤：**
```
test> /list -u
```

**预期输出：**
```
所有用户列表:
  test (ID: 1) - 在线
  alice (ID: 2) - 离线
  bob (ID: 3) - 在线
```

**验证点：**
- ✅ 命令执行成功，无异常
- ✅ 显示用户列表格式正确
- ✅ 包含用户ID、用户名、在线状态

### 2. 测试 `/list -s` (列出当前聊天组用户)

**前置条件：** 需要先进入一个聊天组

**测试步骤：**
```
test> /enter_chat General
test> /list -s
```

**预期输出：**
```
聊天组 'General' 成员列表:
  alice - 在线
  bob - 离线
```

**验证点：**
- ✅ 命令执行成功，无异常
- ✅ 显示当前聊天组成员
- ✅ 如果未进入聊天组，提示"请先进入聊天组"

### 3. 测试 `/list -c` (列出已加入的聊天组)

**测试步骤：**
```
test> /list -c
```

**预期输出：**
```
已加入的聊天组:
  General (ID: 1) - 群聊 - 3人
  Private Chat (ID: 2) - 私聊 - 2人
```

**验证点：**
- ✅ 命令执行成功，无异常
- ✅ 显示已加入的聊天组列表
- ✅ 包含聊天组ID、名称、类型、成员数量

### 4. 测试 `/list -g` (列出所有群聊)

**测试步骤：**
```
test> /list -g
```

**预期输出：**
```
所有群聊列表:
  General (ID: 1) - 5人
  Tech Discussion (ID: 3) - 8人
```

**验证点：**
- ✅ 命令执行成功，无异常
- ✅ 只显示群聊，不显示私聊
- ✅ 包含群聊ID、名称、成员数量

### 5. 测试 `/list -f` (列出当前聊天组文件)

**前置条件：** 需要先进入一个聊天组

**测试步骤：**
```
test> /enter_chat General
test> /list -f
```

**预期输出（有文件时）：**
```
聊天组 'General' 文件列表:
  document.pdf (2.5MB) - 上传者: alice
  image.jpg (1.2MB) - 上传者: bob
```

**预期输出（无文件时）：**
```
当前聊天组暂无文件
```

**验证点：**
- ✅ 命令执行成功，无异常
- ✅ 显示文件列表或提示无文件
- ✅ 包含文件名、大小、上传者

## 边界情况测试

### 1. 空列表测试

**测试场景：**
- 系统中没有其他用户时测试 `/list -u`
- 没有加入任何聊天组时测试 `/list -c`
- 没有公开群聊时测试 `/list -g`

**预期行为：**
- 显示相应的"暂无"提示信息
- 不应该出现异常或错误

### 2. 未登录测试

**测试步骤：**
1. 启动客户端但不登录
2. 尝试执行任何 `/list` 命令

**预期输出：**
```
❌ 请先登录
```

### 3. 未进入聊天组测试

**测试步骤：**
1. 登录但不进入任何聊天组
2. 执行 `/list -s` 或 `/list -f`

**预期输出：**
```
❌ 请先进入聊天组
```

### 4. 无效选项测试

**测试步骤：**
```
test> /list -x
```

**预期输出：**
```
❌ 未知选项: -x。支持的选项: -u, -s, -c, -g, -f
```

### 5. 无选项测试

**测试步骤：**
```
test> /list
```

**预期输出：**
```
❌ 请指定列表类型: -u(用户) -s(当前聊天组用户) -c(已加入聊天组) -g(所有群聊) -f(文件)
```

## 自动化测试

### 运行单元测试

```bash
cd /home/ogas/Code/CN/Chat-Room
python -m pytest test/test_message_parsing_fix.py -v
python -m pytest test/test_list_commands_integration.py -v
```

### 运行所有相关测试

```bash
cd /home/ogas/Code/CN/Chat-Room
python -m pytest test/ -k "list" -v
```

## 故障排除

### 常见问题

1. **AttributeError: 'dict' object has no attribute 'user_id'**
   - 这表示修复没有生效
   - 检查 `shared/messages.py` 中的自定义 `from_dict` 方法

2. **服务器无响应**
   - 检查服务器是否正常运行
   - 检查网络连接
   - 查看服务器日志

3. **命令执行异常**
   - 查看客户端日志文件 `logs/client/client.log`
   - 检查错误详细信息

### 日志检查

**客户端日志：**
```bash
tail -f logs/client/client.log
```

**服务器日志：**
```bash
tail -f logs/server/server.log
```

## 性能测试

### 大量数据测试

1. 创建多个用户账户（10+）
2. 创建多个聊天组（5+）
3. 上传多个文件到聊天组
4. 测试各个 `/list` 命令的响应时间

**预期：**
- 响应时间应在1秒内
- 内存使用稳定
- 无内存泄漏

## 测试报告模板

```
测试日期: [日期]
测试人员: [姓名]
测试环境: [环境描述]

测试结果:
□ /list -u: 通过/失败 - [备注]
□ /list -s: 通过/失败 - [备注]
□ /list -c: 通过/失败 - [备注]
□ /list -g: 通过/失败 - [备注]
□ /list -f: 通过/失败 - [备注]

边界情况:
□ 空列表处理: 通过/失败
□ 未登录处理: 通过/失败
□ 无效选项处理: 通过/失败

问题记录:
[记录发现的问题和解决方案]
```

## 总结

通过以上测试用例的执行，可以确保 `/list` 命令系列的修复完全有效，所有功能都能正常工作。如果发现任何问题，请参考故障排除部分或查看相关日志文件。

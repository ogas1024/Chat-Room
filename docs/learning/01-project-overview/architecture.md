# Chat-Room é¡¹ç›®æ¶æ„æ·±åº¦è§£æ

## ğŸ“ æ•´ä½“æ¶æ„æ¦‚è§ˆ

Chat-Roomé¡¹ç›®é‡‡ç”¨ç»å…¸çš„**å®¢æˆ·ç«¯-æœåŠ¡å™¨æ¶æ„**ï¼Œè¿™æ˜¯ç½‘ç»œåº”ç”¨ç¨‹åºæœ€å¸¸è§çš„æ¶æ„æ¨¡å¼ã€‚è®©æˆ‘ä»¬ä»å®è§‚åˆ°å¾®è§‚ï¼Œé€æ­¥ç†è§£è¿™ä¸ªé¡¹ç›®çš„è®¾è®¡æ€æƒ³ã€‚

### ğŸ—ï¸ æ¶æ„å±‚æ¬¡å›¾

```mermaid
graph TB
    subgraph "ç”¨æˆ·å±‚"
        USER1[ç”¨æˆ·A]
        USER2[ç”¨æˆ·B]
        USER3[ç”¨æˆ·C]
    end
    
    subgraph "å®¢æˆ·ç«¯å±‚"
        CLIENT1[å®¢æˆ·ç«¯A<br/>TUIç•Œé¢]
        CLIENT2[å®¢æˆ·ç«¯B<br/>TUIç•Œé¢]
        CLIENT3[å®¢æˆ·ç«¯C<br/>TUIç•Œé¢]
    end
    
    subgraph "ç½‘ç»œå±‚"
        NETWORK[TCP/IP Socket<br/>ç½‘ç»œé€šä¿¡]
    end
    
    subgraph "æœåŠ¡å™¨å±‚"
        SERVER[Chat-Room Server<br/>å¤šçº¿ç¨‹æœåŠ¡å™¨]
    end
    
    subgraph "æ•°æ®å±‚"
        DATABASE[SQLiteæ•°æ®åº“<br/>ç”¨æˆ·/æ¶ˆæ¯/æ–‡ä»¶]
        FILES[æ–‡ä»¶ç³»ç»Ÿ<br/>æ–‡ä»¶å­˜å‚¨]
    end
    
    subgraph "å¤–éƒ¨æœåŠ¡"
        AI[æ™ºè°±AI<br/>GLM-4-Flash]
    end
    
    USER1 --> CLIENT1
    USER2 --> CLIENT2
    USER3 --> CLIENT3
    
    CLIENT1 <--> NETWORK
    CLIENT2 <--> NETWORK
    CLIENT3 <--> NETWORK
    
    NETWORK <--> SERVER
    
    SERVER --> DATABASE
    SERVER --> FILES
    SERVER --> AI
```

## ğŸ¯ ä¸ºä»€ä¹ˆé€‰æ‹©è¿™ç§æ¶æ„ï¼Ÿ

### å®¢æˆ·ç«¯-æœåŠ¡å™¨æ¶æ„çš„ä¼˜åŠ¿

1. **é›†ä¸­ç®¡ç†**ï¼šæ‰€æœ‰ç”¨æˆ·æ•°æ®å’ŒèŠå¤©è®°å½•é›†ä¸­å­˜å‚¨åœ¨æœåŠ¡å™¨
2. **å®æ—¶é€šä¿¡**ï¼šæœåŠ¡å™¨ä½œä¸ºä¸­è½¬ç«™ï¼Œå®ç°ç”¨æˆ·é—´çš„å®æ—¶æ¶ˆæ¯ä¼ é€’
3. **å¯æ‰©å±•æ€§**ï¼šå¯ä»¥æ”¯æŒä»»æ„æ•°é‡çš„å®¢æˆ·ç«¯è¿æ¥
4. **æ•°æ®ä¸€è‡´æ€§**ï¼šç»Ÿä¸€çš„æ•°æ®ç®¡ç†é¿å…äº†æ•°æ®å†²çª
5. **å®‰å…¨æ€§**ï¼šæ•æ„Ÿæ“ä½œåœ¨æœåŠ¡å™¨ç«¯æ‰§è¡Œï¼Œæé«˜å®‰å…¨æ€§

### æ¨¡å—åŒ–è®¾è®¡çš„å¥½å¤„

```mermaid
graph LR
    subgraph "è®¾è®¡åŸåˆ™"
        A[å•ä¸€èŒè´£åŸåˆ™]
        B[å¼€é—­åŸåˆ™]
        C[ä¾èµ–å€’ç½®åŸåˆ™]
        D[æ¥å£éš”ç¦»åŸåˆ™]
    end
    
    subgraph "å®é™…æ•ˆæœ"
        E[æ˜“äºç»´æŠ¤]
        F[ä¾¿äºæµ‹è¯•]
        G[æ”¯æŒæ‰©å±•]
        H[é™ä½è€¦åˆ]
    end
    
    A --> E
    B --> G
    C --> H
    D --> F
```

## ğŸ“ é¡¹ç›®ç›®å½•ç»“æ„è§£æ

### é¡¶å±‚ç›®å½•è®¾è®¡æ€æƒ³

```
Chat-Room/
â”œâ”€â”€ client/          # å®¢æˆ·ç«¯æ¨¡å— - ç”¨æˆ·äº¤äº’å±‚
â”œâ”€â”€ server/          # æœåŠ¡å™¨æ¨¡å— - ä¸šåŠ¡é€»è¾‘å±‚
â”œâ”€â”€ shared/          # å…±äº«æ¨¡å— - é€šç”¨ç»„ä»¶å±‚
â”œâ”€â”€ config/          # é…ç½®æ–‡ä»¶ - é…ç½®ç®¡ç†å±‚
â”œâ”€â”€ docs/            # æ–‡æ¡£ç›®å½• - çŸ¥è¯†ç®¡ç†å±‚
â”œâ”€â”€ test/            # æµ‹è¯•ä»£ç  - è´¨é‡ä¿è¯å±‚
â”œâ”€â”€ demo/            # æ¼”ç¤ºä»£ç  - å­¦ä¹ å±•ç¤ºå±‚
â”œâ”€â”€ archive/         # å½’æ¡£æ–‡ä»¶ - å†å²ç®¡ç†å±‚
â””â”€â”€ main.py          # ç¨‹åºå…¥å£ - å¯åŠ¨æ§åˆ¶å±‚
```

**è®¾è®¡æ€è€ƒ**ï¼š
- **æŒ‰åŠŸèƒ½åˆ†å±‚**ï¼šæ¯ä¸ªç›®å½•éƒ½æœ‰æ˜ç¡®çš„èŒè´£
- **ä¾èµ–å…³ç³»æ¸…æ™°**ï¼šsharedè¢«clientå’Œserverä¾èµ–ï¼Œä½†ä¸ä¾èµ–å®ƒä»¬
- **é…ç½®å¤–ç½®**ï¼šé…ç½®æ–‡ä»¶ç‹¬ç«‹ç®¡ç†ï¼Œä¾¿äºéƒ¨ç½²å’Œç»´æŠ¤
- **æ–‡æ¡£å®Œå–„**ï¼šè¯¦ç»†çš„æ–‡æ¡£æ”¯æŒå­¦ä¹ å’Œç»´æŠ¤

### æ¨¡å—ä¾èµ–å…³ç³»

```mermaid
graph TD
    MAIN[main.py<br/>ç¨‹åºå…¥å£]
    
    subgraph "åº”ç”¨å±‚"
        CLIENT[client/<br/>å®¢æˆ·ç«¯åº”ç”¨]
        SERVER[server/<br/>æœåŠ¡å™¨åº”ç”¨]
    end
    
    subgraph "åŸºç¡€å±‚"
        SHARED[shared/<br/>å…±äº«ç»„ä»¶]
        CONFIG[config/<br/>é…ç½®ç®¡ç†]
    end
    
    subgraph "æ”¯æŒå±‚"
        DOCS[docs/<br/>æ–‡æ¡£]
        TEST[test/<br/>æµ‹è¯•]
        DEMO[demo/<br/>æ¼”ç¤º]
    end
    
    MAIN --> CLIENT
    MAIN --> SERVER
    MAIN --> DEMO
    
    CLIENT --> SHARED
    CLIENT --> CONFIG
    SERVER --> SHARED
    SERVER --> CONFIG
    
    TEST --> CLIENT
    TEST --> SERVER
    TEST --> SHARED
```

## ğŸ”§ æ ¸å¿ƒæ¨¡å—è¯¦è§£

### 1. å…±äº«æ¨¡å— (shared/)

**ä½œç”¨**ï¼šå®šä¹‰å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨éƒ½éœ€è¦ä½¿ç”¨çš„é€šç”¨ç»„ä»¶

```python
shared/
â”œâ”€â”€ constants.py     # å¸¸é‡å®šä¹‰ - é¿å…é­”æ³•æ•°å­—
â”œâ”€â”€ messages.py      # æ¶ˆæ¯åè®® - ç»Ÿä¸€é€šä¿¡æ ¼å¼
â”œâ”€â”€ exceptions.py    # å¼‚å¸¸å®šä¹‰ - ç»Ÿä¸€é”™è¯¯å¤„ç†
â”œâ”€â”€ logger.py        # æ—¥å¿—ç³»ç»Ÿ - ç»Ÿä¸€æ—¥å¿—ç®¡ç†
â””â”€â”€ config_manager.py # é…ç½®ç®¡ç† - ç»Ÿä¸€é…ç½®æ¥å£
```

**è®¾è®¡äº®ç‚¹**ï¼š
- **é¿å…é‡å¤ä»£ç **ï¼šå…¬å…±é€»è¾‘åªå†™ä¸€æ¬¡
- **ä¿è¯ä¸€è‡´æ€§**ï¼šå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä½¿ç”¨ç›¸åŒçš„åè®®
- **ä¾¿äºç»´æŠ¤**ï¼šä¿®æ”¹åè®®åªéœ€è¦æ”¹ä¸€ä¸ªåœ°æ–¹

### 2. æœåŠ¡å™¨æ¨¡å— (server/)

**ä½œç”¨**ï¼šå¤„ç†ä¸šåŠ¡é€»è¾‘ã€æ•°æ®å­˜å‚¨ã€ç”¨æˆ·ç®¡ç†

```python
server/
â”œâ”€â”€ main.py          # æœåŠ¡å™¨å…¥å£
â”œâ”€â”€ core/            # æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
â”‚   â”œâ”€â”€ server.py    # ä¸»æœåŠ¡å™¨ç±»
â”‚   â”œâ”€â”€ user_manager.py   # ç”¨æˆ·ç®¡ç†
â”‚   â””â”€â”€ chat_manager.py   # èŠå¤©ç®¡ç†
â”œâ”€â”€ database/        # æ•°æ®åº“æ“ä½œ
â”‚   â”œâ”€â”€ models.py    # æ•°æ®æ¨¡å‹
â”‚   â””â”€â”€ connection.py # æ•°æ®åº“è¿æ¥
â”œâ”€â”€ ai/              # AIé›†æˆ
â”‚   â””â”€â”€ ai_manager.py # AIç®¡ç†å™¨
â””â”€â”€ utils/           # å·¥å…·å‡½æ•°
    â””â”€â”€ auth.py      # è®¤è¯å·¥å…·
```

**æ¶æ„ç‰¹ç‚¹**ï¼š
- **åˆ†å±‚è®¾è®¡**ï¼šcoreå¤„ç†ä¸šåŠ¡é€»è¾‘ï¼Œdatabaseå¤„ç†æ•°æ®ï¼Œutilsæä¾›å·¥å…·
- **å•ä¸€èŒè´£**ï¼šæ¯ä¸ªæ¨¡å—åªè´Ÿè´£ä¸€ä¸ªç‰¹å®šåŠŸèƒ½
- **ä¾èµ–æ³¨å…¥**ï¼šé€šè¿‡å‚æ•°ä¼ é€’ä¾èµ–ï¼Œä¾¿äºæµ‹è¯•

### 3. å®¢æˆ·ç«¯æ¨¡å— (client/)

**ä½œç”¨**ï¼šæä¾›ç”¨æˆ·ç•Œé¢ã€å¤„ç†ç”¨æˆ·è¾“å…¥ã€ä¸æœåŠ¡å™¨é€šä¿¡

```python
client/
â”œâ”€â”€ main.py          # å®¢æˆ·ç«¯å…¥å£
â”œâ”€â”€ core/            # æ ¸å¿ƒé€šä¿¡
â”‚   â””â”€â”€ client.py    # ç½‘ç»œå®¢æˆ·ç«¯
â”œâ”€â”€ ui/              # ç”¨æˆ·ç•Œé¢
â”‚   â”œâ”€â”€ app.py       # ä¸»åº”ç”¨
â”‚   â”œâ”€â”€ components.py # UIç»„ä»¶
â”‚   â””â”€â”€ themes/      # ä¸»é¢˜ç³»ç»Ÿ
â”œâ”€â”€ commands/        # å‘½ä»¤ç³»ç»Ÿ
â”‚   â””â”€â”€ parser.py    # å‘½ä»¤è§£æ
â””â”€â”€ config/          # å®¢æˆ·ç«¯é…ç½®
```

**è®¾è®¡æ€æƒ³**ï¼š
- **MVCæ¨¡å¼**ï¼šuiè´Ÿè´£è§†å›¾ï¼Œcoreè´Ÿè´£æ¨¡å‹ï¼Œcommandsè´Ÿè´£æ§åˆ¶
- **ç»„ä»¶åŒ–**ï¼šUIç»„ä»¶å¯ä»¥ç‹¬ç«‹å¼€å‘å’Œæµ‹è¯•
- **å¯æ‰©å±•**ï¼šæ–°å‘½ä»¤å’Œæ–°ä¸»é¢˜å¯ä»¥è½»æ¾æ·»åŠ 

## ğŸ”„ æ•°æ®æµåˆ†æ

### æ¶ˆæ¯å‘é€æµç¨‹

```mermaid
sequenceDiagram
    participant U as ç”¨æˆ·
    participant C as å®¢æˆ·ç«¯
    participant S as æœåŠ¡å™¨
    participant D as æ•°æ®åº“
    participant O as å…¶ä»–å®¢æˆ·ç«¯
    
    U->>C: è¾“å…¥æ¶ˆæ¯
    C->>C: è§£æå‘½ä»¤/æ¶ˆæ¯
    C->>S: å‘é€æ¶ˆæ¯è¯·æ±‚
    S->>S: éªŒè¯ç”¨æˆ·æƒé™
    S->>D: ä¿å­˜æ¶ˆæ¯åˆ°æ•°æ®åº“
    S->>O: å¹¿æ’­æ¶ˆæ¯ç»™å…¶ä»–ç”¨æˆ·
    S->>C: å‘é€ç¡®è®¤å“åº”
    C->>U: æ˜¾ç¤ºå‘é€ç»“æœ
```

### ç”¨æˆ·ç™»å½•æµç¨‹

```mermaid
sequenceDiagram
    participant U as ç”¨æˆ·
    participant C as å®¢æˆ·ç«¯
    participant S as æœåŠ¡å™¨
    participant D as æ•°æ®åº“
    
    U->>C: è¾“å…¥ç”¨æˆ·åå¯†ç 
    C->>S: å‘é€ç™»å½•è¯·æ±‚
    S->>D: éªŒè¯ç”¨æˆ·å‡­æ®
    D->>S: è¿”å›ç”¨æˆ·ä¿¡æ¯
    S->>S: åˆ›å»ºç”¨æˆ·ä¼šè¯
    S->>C: å‘é€ç™»å½•å“åº”
    C->>C: ä¿å­˜ç”¨æˆ·çŠ¶æ€
    C->>U: æ˜¾ç¤ºç™»å½•æˆåŠŸ
```

## ğŸ¨ è®¾è®¡æ¨¡å¼åº”ç”¨

### 1. å•ä¾‹æ¨¡å¼ (Singleton)
```python
# æ•°æ®åº“è¿æ¥ç®¡ç†
class DatabaseManager:
    _instance = None
    
    def __new__(cls):
        if cls._instance is None:
            cls._instance = super().__new__(cls)
        return cls._instance
```

**ä¸ºä»€ä¹ˆä½¿ç”¨**ï¼šç¡®ä¿æ•´ä¸ªåº”ç”¨åªæœ‰ä¸€ä¸ªæ•°æ®åº“è¿æ¥å®ä¾‹

### 2. å·¥å‚æ¨¡å¼ (Factory)
```python
# æ¶ˆæ¯åˆ›å»ºå·¥å‚
def create_message_from_dict(data: Dict[str, Any]) -> BaseMessage:
    message_type = data.get("message_type")
    message_class = message_classes.get(message_type, BaseMessage)
    return message_class.from_dict(data)
```

**ä¸ºä»€ä¹ˆä½¿ç”¨**ï¼šæ ¹æ®æ¶ˆæ¯ç±»å‹åŠ¨æ€åˆ›å»ºä¸åŒçš„æ¶ˆæ¯å¯¹è±¡

### 3. è§‚å¯Ÿè€…æ¨¡å¼ (Observer)
```python
# UIç»„ä»¶å“åº”æ•°æ®å˜åŒ–
class StatusPanel(Static):
    connection_status = reactive("æœªè¿æ¥")  # å“åº”å¼å±æ€§
    
    def watch_connection_status(self, old_value, new_value):
        self.refresh()  # è‡ªåŠ¨æ›´æ–°ç•Œé¢
```

**ä¸ºä»€ä¹ˆä½¿ç”¨**ï¼šç•Œé¢è‡ªåŠ¨å“åº”æ•°æ®çŠ¶æ€å˜åŒ–

### 4. è£…é¥°å™¨æ¨¡å¼ (Decorator)
```python
# å‘½ä»¤å‚æ•°éªŒè¯è£…é¥°å™¨
def require_args(min_args: int = 1):
    def decorator(func):
        def wrapper(self, command):
            if len(command.args) < min_args:
                return False, "å‚æ•°ä¸è¶³"
            return func(self, command)
        return wrapper
    return decorator
```

**ä¸ºä»€ä¹ˆä½¿ç”¨**ï¼šä¸ºå‡½æ•°æ·»åŠ é€šç”¨çš„å‚æ•°éªŒè¯é€»è¾‘

## ğŸš€ æ¶æ„ä¼˜åŠ¿æ€»ç»“

### 1. å¯ç»´æŠ¤æ€§
- **æ¨¡å—åŒ–è®¾è®¡**ï¼šæ¯ä¸ªæ¨¡å—èŒè´£å•ä¸€ï¼Œä¿®æ”¹å½±å“èŒƒå›´å°
- **æ¸…æ™°çš„æ¥å£**ï¼šæ¨¡å—é—´é€šè¿‡æ˜ç¡®çš„æ¥å£é€šä¿¡
- **å®Œå–„çš„æ–‡æ¡£**ï¼šè¯¦ç»†çš„ä»£ç æ³¨é‡Šå’Œæ–‡æ¡£

### 2. å¯æ‰©å±•æ€§
- **æ’ä»¶åŒ–æ¶æ„**ï¼šæ–°åŠŸèƒ½å¯ä»¥ä½œä¸ºæ’ä»¶æ·»åŠ 
- **é…ç½®é©±åŠ¨**ï¼šé€šè¿‡é…ç½®æ–‡ä»¶æ§åˆ¶åŠŸèƒ½å¼€å…³
- **æ ‡å‡†åŒ–æ¥å£**ï¼šæ–°æ¨¡å—éµå¾ªç°æœ‰æ¥å£è§„èŒƒ

### 3. å¯æµ‹è¯•æ€§
- **ä¾èµ–æ³¨å…¥**ï¼šä¾¿äºæ¨¡æ‹Ÿä¾èµ–è¿›è¡Œå•å…ƒæµ‹è¯•
- **åˆ†å±‚æ¶æ„**ï¼šæ¯ä¸€å±‚éƒ½å¯ä»¥ç‹¬ç«‹æµ‹è¯•
- **æ¥å£æŠ½è±¡**ï¼šé€šè¿‡æ¥å£éš”ç¦»å…·ä½“å®ç°

### 4. æ€§èƒ½ä¼˜åŒ–
- **å¤šçº¿ç¨‹å¤„ç†**ï¼šæœåŠ¡å™¨æ”¯æŒå¹¶å‘è¿æ¥
- **è¿æ¥æ± ç®¡ç†**ï¼šæ•°æ®åº“è¿æ¥å¤ç”¨
- **ç¼“å­˜æœºåˆ¶**ï¼šå‡å°‘é‡å¤è®¡ç®—å’ŒæŸ¥è¯¢

## ğŸ’¡ å­¦ä¹ å»ºè®®

1. **ä»æ•´ä½“åˆ°å±€éƒ¨**ï¼šå…ˆç†è§£æ•´ä½“æ¶æ„ï¼Œå†æ·±å…¥å…·ä½“æ¨¡å—
2. **å…³æ³¨æ¥å£è®¾è®¡**ï¼šé‡ç‚¹å­¦ä¹ æ¨¡å—é—´çš„æ¥å£å®šä¹‰
3. **ç†è§£è®¾è®¡æ¨¡å¼**ï¼šè¯†åˆ«å’Œç†è§£é¡¹ç›®ä¸­ä½¿ç”¨çš„è®¾è®¡æ¨¡å¼
4. **åŠ¨æ‰‹å®è·µ**ï¼šå°è¯•ä¿®æ”¹æ¶æ„ï¼Œè§‚å¯Ÿå½±å“
5. **å¯¹æ¯”å­¦ä¹ **ï¼šä¸å…¶ä»–é¡¹ç›®çš„æ¶æ„è¿›è¡Œå¯¹æ¯”

---

**ä¸‹ä¸€æ­¥**ï¼šå­¦ä¹ å…·ä½“çš„åŠŸèƒ½ç‰¹æ€§ â†’ [features.md](./features.md)
